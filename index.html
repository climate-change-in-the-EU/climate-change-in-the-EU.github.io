<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Europinion on Climate Change</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/scrolling-nav.css" rel="stylesheet">

  <!-- necessary scripts for data processing and visualization -->
  <script src="js/plotly-latest.min.js"></script>
  <script src="js/d3.v5.js"></script>
  <script src="js/xmlToJson.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
          integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
          crossorigin=""></script>
  <script src="js/leaflet.ajax.min.js"></script>
  <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top d-flex flex-column" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">Europinion on Climate Change</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#introduction">Introduction</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#visualization">Visualization</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#original-datasets">Original datasets</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#output-datasets">Output datasets</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#documentation">Documentation</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="#license">License</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <header class="bg-primary text-white">
    <div class="container text-center">
      <h1>Europinion on Climate Change</h1>
      <p class="lead">An overview of the European peoples' judgments and actions concerning climate change</p>
    </div>
  </header>

  <section id="introduction">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Introduction</h2>
          <p class="lead">This project investigates the European public's opinion on the problem of climate change and attempts to correlate it with various data on actual national greenhouse gas emissions and energy usage from renewable sources.
            It uses openly accessible datasets which have been processed for comparability and visualized in the form of graphs.
            The leading questions these reports address are as follows:</p>
          <ul>
            <li>Do Europeans have comparable views on the problem of climate change across countries? If so, has this been always been the case in past years?</li>
            <li>Generally, how serious do Europeans deem the problem of climate change to be?</li>
            <li>Does the concern for climate change reflect in national consumption statistics, e.g. greenhouse gas emissions or the share of energy generated from renewable sources?</li>
          </ul>
          <p class="lead">This website offers an interactive tool compiled for users to explore the nationally varying answers to these questions.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="visualization" class="bg-light">
    <div class="container">
        <h2>Visualization</h2>
      <p class="lead">Choose one or more EU countries on the map and which data to visualize on the right</p>
      <br/>
        <div class="row">
          <div class="col-6">
            <div id="geomap" class="d-flex align-center" style="height: 70vh; width: 40vw; padding: 1vw 1vh"></div>
          </div>
          <div class="col-6">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="vis-list" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" href="#eb_plot_1" role="tab" aria-controls="eb_plot_1" aria-selected="true">How serious do you consider the problem of climate change to be?</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#eb_plot_2" role="tab" aria-controls="eb_plot_2" aria-selected="false">What is the most significant problem facing the world today?</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#stats_plot_1" role="tab" aria_controls="stats_plot_1" aria-selected="false">Greenhouse gas emissions per capita</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#stats_plot_2" role="tab" aria_controls="stats_plot_2" aria-selected="false">Share of national energy consumption from renewable sources</a>
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <div class="tab-content mx-auto">
                  <div class="tab-pane active" id="eb_plot_1" role="tabpanel" aria-labelledby="eb_plot_1-tab" style="height:300px; width: 500px">
                    <div id="plotspace1"></div>
                  </div>
                  <div class="tab-pane" id="eb_plot_2" role="tabpanel" aria-labelledby="eb_plot_2-tab" style="height:300px; width: 500px">
                    <div id="plotspace2"></div>
                  </div>
                  <div class="tab-pane" id="stats_plot_1" role="tabpanel" aria-labelledby="stats_plot_1-tab" style="height:300px; width: 500px">
                    <div id="plotspace3"></div>
                  </div>
                  <div class="tab-pane" id="stats_plot_2" role="tabpanel" aria-labelledby="stats_plot_2-tab" style="height:300px; width: 500px">
                    <div id="plotspace4"></div>
                  </div>
              </div>
            </div>
              <div class="card-footer">
                <button id="resetPanels" onclick="resetPanels()" class="btn btn-primary">Reset Graphs</button>
              </div>
          </div>
        </div>
            <script>
              $('#vis-list a').on('click', function (e) {
                e.preventDefault()
                $(this).tab('show')
              });
            </script>
            <script>
              eb_plot_1_div = document.getElementById('plotspace1');
              eb_plot_2_div = document.getElementById('plotspace2');
              stats_plot_1_div = document.getElementById('plotspace3');
              stats_plot_2_div = document.getElementById('plotspace4');

              var eb_plot_1 = function(inputid) {
                d3.xml("data/processed_data/mashup/mashup.xml")
                        .then(function (data) {
                          var country_id = inputid;
                          var dataobj = xmlToJson.parse(data).root.country;
                          var country_data = dataobj.filter(obj => {
                            return obj.id === country_id
                          })[0];
                          return country_data;
                        }).then(function (data) {
                  var surveys = {};
                  if(typeof data !== "undefined") {
                  for (i = 0; i < data.eurobarometer.survey.length; i++) {
                    var survey = data.eurobarometer.survey[i];
                    if (Array.isArray(survey.question)) {
                      for (q in survey.question) {
                        var question = survey.question[q].id;
                        if (question === 'severity_of_problem') {
                          surveys[survey.id] = survey.question[q].response;
                        }
                      }
                    } else {
                      var question = survey.question.id;
                      if (question === 'severity_of_problem') {
                        surveys[survey.id] = survey.question.response;
                      }
                    }
                  }
                  var layout = {
                    autosize: false,
                    width: 500,
                    height: 300,
                    xaxis: {
                      type: 'category',
                      title: 'Eurobarometer survey'
                    },
                    yaxis: {
                      title: 'severity (1-10)'
                    },
                    legend: {
                      itemclick: 'toggleothers',
                      itemdoubleclick: 'toggle',
                    },
                    margin: { t: 10 },
                    hoverinfo: 'text+y',
                    hovermode: 'closest'
                  };

                  var trace = [{
                    x: Object.keys(surveys),
                    y: Object.values(surveys),
                    line: { width: 3 },
                    name: inputid
                  }]
                  Plotly.plot(eb_plot_1_div, trace, layout)
                  }
                });
              };

              var eb_plot_2 = function(inputid) {
                d3.xml("data/processed_data/mashup/mashup.xml")
                        .then(function(data) {
                          var country_id = inputid;
                          var dataobj =  xmlToJson.parse(data).root.country;
                          var country_data = dataobj.filter(obj => {
                            return obj.id === country_id
                          })[0];
                          return country_data;
                        }).then(function(data) {
                  var surveys = {};
                  if(typeof data !== "undefined") {
                    for (i = 0; i < data.eurobarometer.survey.length; i++) {
                      var survey = data.eurobarometer.survey[i];
                      if (Array.isArray(survey.question)) {
                        surveys[survey.id] = survey.question[0].response;
                      } else {
                        surveys[survey.id] = survey.question.response;
                      }
                    }
                    var layout = {
                      autosize: false,
                      width: 500,
                      height: 300,
                      xaxis: {
                        type: 'category',
                        title: 'Eurobarometer Survey'
                      },
                      yaxis: {
                        tickformat: ',.0%',
                        title: 'Answer: "climate change"'
                      },
                      legend: {
                        itemclick: 'toggleothers',
                        itemdoubleclick: 'toggle'
                      },
                      margin: { t: 10 },
                      hoverinfo: 'text+y',
                      hovermode: 'closest'
                    };

                    var trace = [{
                      x: Object.keys(surveys),
                      y: Object.values(surveys),
                      line: { width: 3 },
                      name: inputid
                    }]
                    Plotly.plot(eb_plot_2_div, trace, layout)
                  }
                });
              };

              var stats_plot_1 = function(inputid) {
                d3.xml("data/processed_data/mashup/mashup.xml")
                        .then(function(data) {
                          var country_id = inputid;
                          var dataobj =  xmlToJson.parse(data).root.country;
                          var country_data = dataobj.filter(obj => {
                            return obj.id === country_id
                          })[0];
                          return country_data;
                        }).then(function(data) {
                  if(typeof data !== "undefined") {
                    var years = data.ghg_emissions.value;
                    var values = {};
                    for (year in years) {
                      values[years[year].id] = years[year].text;
                    }
                    var layout = {
                      autosize: true,
                      width: 500,
                      height: 300,
                      xaxis: {
                        type: 'category',
                        title: 'year'
                      },
                      yaxis: {
                        title: 'tons per capita'
                      },
                      legend: {
                        itemclick: 'toggleothers',
                        itemdoubleclick: 'toggle'
                      },
                      margin: { t: 10 },
                      hoverinfo: 'text+y',
                      hovermode: 'closest'
                    };
                    var trace = [{
                      x: Object.keys(values),
                      y: Object.values(values),
                      line: { width: 3 },
                      name: inputid
                    }]
                    Plotly.plot(stats_plot_1_div, trace, layout);
                  }
                });
              };

              var stats_plot_2 = function(inputid) {
                d3.xml("data/processed_data/mashup/mashup.xml")
                        .then(function(data) {
                          var country_id = inputid;
                          var dataobj =  xmlToJson.parse(data).root.country;
                          var country_data = dataobj.filter(obj => {
                            return obj.id === country_id
                          })[0];
                          return country_data;
                        }).then(function(data) {
                  if(typeof data !== "undefined") {
                  var years = data.share_renewable.value;
                  var values = {};
                  for (year in years) {
                    values[years[year].id] = years[year].text;
                  }
                  var layout = {
                    autosize: false,
                    width: 500,
                    height: 300,
                    xaxis: {
                      type: 'category',
                      title: 'year'
                    },
                    yaxis: {
                      title: 'renewable sources',
                      ticksuffix: '%'
                    },
                    legend: {
                      itemclick: 'toggleothers',
                      itemdoubleclick: 'toggle'
                    },
                    margin: { t: 10 },
                    hoverinfo: 'text+y',
                    hovermode: 'closest'
                  };
                  var trace = [{
                    x: Object.keys(values),
                    y: Object.values(values),
                    line: { width: 3 },
                    name: inputid
                  }]
                  Plotly.plot(stats_plot_2_div, trace, layout);
                }
                });
              };

              var id;
              var main_map = L.map('geomap', attributionControl=false).setView([54,10], 3);
              function onMapClick(e) {
                clicked_coords = e.latlng;
                  var poly = leafletPip.pointInLayer(clicked_coords, main_map);
                  id = poly[0].feature.properties.iso_a2;
                  eb_plot_1(id);
                  eb_plot_2(id);
                  stats_plot_1(id);
                  stats_plot_2(id);
              }
              function resetPanels() {
                var graph1 = document.getElementById('plotspace1');
                Plotly.purge(graph1);
                var graph2 = document.getElementById('plotspace2');
                Plotly.purge(graph2);
                var graph3 = document.getElementById('plotspace3');
                Plotly.purge(graph3);
                var graph4 = document.getElementById('plotspace4');
                Plotly.purge(graph4);
              }
              L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                accessToken: 'pk.eyJ1IjoibGhlbm5lIiwiYSI6ImNrNWJsaXhidDFoeDczcGxqaGxrbnJ2Y20ifQ.U1dvdEcuMIcf41VGJNC6zQ'
              }).addTo(main_map);
              var geojsonLayer = L.geoJson.ajax("europe.geojson");
              geojsonLayer.addTo(main_map);
              main_map.on('click', onMapClick);
            </script>
          </div>
        </div>
  </section>

  <section id="original-datasets">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 mx-auto">
          <h2>Original datasets</h2>
          <div class="card-deck">
            <div class="card">
              <div class="card-header d-flex align-items-center justify-content-center">
                <h5 class="card-title">Eurobarometer surveys on climate change</h5>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S1461_69_2_300">Eurobarometer 300 (2008)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S1461_69_2_300.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S942_71_1_EBS313">Eurobarometer 313 (2009)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S942_71_1_EBS313.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S703_72_1_EBS322">Eurobarometer 322 (2009)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S703_72_1_EBS322.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S1007_75_4_EBS372">Eurobarometer 372 (2011)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S1007_75_4_EBS372.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S1084_80_2_409">Eurobarometer 409 (2014)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S1084_80_2_409.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S2060_83_4_435_ENG">Eurobarometer 435 (2015)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S2060_83_4_435_ENG.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S2140_87_1_459_ENG">Eurobarometer 459 (2017)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S2140_87_1_459_ENG.rdf">Metadata in RDF format</a>)
                </li>
                <li class="list-group-item">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/S2212_91_3_490_ENG">Eurobarometer 490 (2019)</a>
                  (<a href="https://data.europa.eu/euodp/en/data/dataset/S2212_91_3_490_ENG.rdf">Metadata in RDF format</a>)
                </li>
              </ul>
            </div>
            <div class="card">
              <div class="card-header d-flex align-items-center justify-content-center">
                <h5 class="card-title">Data on greenhouse gas emissions</h5>
              </div>
              <div class="card-body">
                <div class="card-text">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/rc2ELCDeTGfxdpE27gyzow">Eurostat data on Greenhouse gas emissions per capita</a>
                  (<a href="http://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/t2020_rd300.tsv.gz">Download dataset in TSV format</a>, <a href="https://data.europa.eu/euodp/en/data/dataset/rc2ELCDeTGfxdpE27gyzow.rdf">Metadata in RDF format</a>)
                </div>
              </div>
              <div class="card-footer">
                Covering EU countries in the time between 2000 and 2017
              </div>
            </div>
            <div class="card">
              <div class="card-header d-flex align-items-center justify-content-center">
                <h5 class="card-title">Share of renewable energy</h5>
              </div>
              <div class="card-body">
                <div class="card-text">
                  <a href="https://data.europa.eu/euodp/en/data/dataset/kLwnawdAsL0qfRS0PzvDfw">Eurostat data on the share of renewable energy in gross final energy consumption</a>
                  (<a href="http://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/t2020_31.tsv.gz">Download dataset in TSV format</a>, <a href="https://data.europa.eu/euodp/en/data/dataset/kLwnawdAsL0qfRS0PzvDfw.rdf">Metadata in RDF format</a>)
                </div>
              </div>
              <div class="card-footer">
                Covering EU countries in the time between 2004 and 2017
              </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="output-datasets">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Output datasets</h2>
          <p class="lead">A Python script <a href="https://github.com/climate-change-in-the-EU/climate-change-in-the-EU.github.io/blob/master/python_scripts/mashup.py">mashup.py</a> was created to automatically process the input datasets, clean the data and consolidate them into the mashup dataset, <a href="https://github.com/climate-change-in-the-EU/climate-change-in-the-EU.github.io/blob/master/data/processed_data/mashup/mashup.xml">mashup.xml</a>.</p>
          <p class="lead">Ahead of the consolidation, data from the Eurobarometer surveys was processed and output in CSV format. These intermediate files can also be found in the project's <a href="https://github.com/climate-change-in-the-EU/climate-change-in-the-EU.github.io/tree/master/data/processed_data/special_eb/data/3_final">project's Github repository</a>.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="documentation">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>Documentation</h2>
          <p class="lead">The project was documented extensively during and after the main development process. New content will be added as development continues.</p>
          <p class="lead">The documentation can be found in the project's <a href="https://github.com/climate-change-in-the-EU/climate-change-in-the-EU.github.io">Github repository</a>, as can all resources pertaining to the project.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="license">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2>License</h2>
          <p class="lead">This website is licensed under the Creative Commons 4.0 Share-Alike license. The <a href="https://github.com/climate-change-in-the-EU/climate-change-in-the-EU.github.io/blob/master/README.md">project documentation</a> includes further information on the license terms of individual datasets.</p>
          <p class="lead"><i>Scrolling Nav</i> Bootstrap template is licensed under The MIT License (MIT), &copy; 2013-2019 Blackrock Digital LLC.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-5 bg-dark">
    <div class="container">
      <p class="m-0 text-center text-white">&copy; Elisabeth Reuhl, Lukas Henne 2020</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom JavaScript for this theme -->
  <script src="js/scrolling-nav.js"></script>

</body>

</html>


/* OLD PLOTS */
  <!-- <script>
      d3.xml("processed_data/mashup/mashup.xml")
              .then(function(data) {
                var country_id = input_country;
                var dataobj =  xmlToJson.parse(data).root.country;
                var country_data = dataobj.filter(obj => {
                  return obj.id === country_id
                })[0];
                return country_data;
              }).then(function(data) {
        var surveys = {};
        for (i = 0; i < data.eurobarometer.survey.length; i++) {
          var survey = data.eurobarometer.survey[i];
          if (Array.isArray(survey.question)) {
            surveys[survey.id] = survey.question[0].response;
          } else {
            surveys[survey.id] = survey.question.response;
          }
        }
        var layout = {
          title: '"Climate change is the most significant problem facing the world today."',
          xaxis: {
            type: 'category',
            title: 'Eurobarometer Survey'
          },
          yaxis: {
            tickformat: ',.0%'
          },
          legend: {
            itemclick: 'toggleothers',
            itemdoubleclick: 'toggle'
          },
          hoverinfo: 'text+y',
          hovermode: 'closest'
        };

        var trace = [{
          x: Object.keys(surveys),
          y: Object.values(surveys)
        }]
        Plotly.plot( eb_plot_1, trace, layout, {scrollZoom: true})
      });
    }
  </script> -->
          <!--
          <div id="comparison_problem_renewables_eu"></div>
          <div id="most_serious_problem_plot"></div>
          <div id="avg_severity_plot"></div>
          <div id="map_severity"></div>
          <div id="ghg_emissions_plot"></div>
          <div id="share_renewable_plot"></div>
          <div id="map_renewables_2017"></div>
          <script>

            comparison_problem_renewables_eu = document.getElementById("comparison_problem_renewables_eu")
            most_serious_problem_plot = document.getElementById("most_serious_problem_plot");
            avg_severity_plot = document.getElementById("avg_severity_plot");
            map_severity = document.getElementById("map_severity");
            ghg_emissions_plot = document.getElementById("ghg_emissions_plot");
            share_renewable_plot = document.getElementById("share_renewable_plot");
            map_renewables_2017 = document.getElementById("map_renewables_2017");

            Promise.all([
                        d3.xml("processed_data/most_serious_problem/most_serious_problem.xml"),
                        d3.tsv("processed_data/share_renewable/share_renewable.tsv")
                      ]).then(function(data) {
                        plot_data = [];
                        var dataobj_problem = xmlToJson.parse(data[0]).root.survey;
                        var surveys = {};
                        for (i = 0; i < dataobj_problem.length; i++) {
                          var countries = {};
                          for (j = 0; j < dataobj_problem[i].country.length; j++) {
                            countries[dataobj_problem[i].country[j].id] = dataobj_problem[i].country[j].share;
                          }
                          surveys[dataobj_problem[i].date] = countries;
                        }

              var dataobj_renewable = data[1];
              var years = [2008,2009,2010,2011,2012,2013,2014,2015,2016,2017]
              var data_by_country = {};
              for (i = 4; i < dataobj_renewable.length; i++) {
                var country = dataobj_renewable[i]["geo\\time"];
                for (j = 0; j < years.length; j++) {
                  var values_by_year = Object.values(dataobj_renewable[i]).slice(1, );
                  data_by_country[country] = values_by_year;
                }
              }
              var trace1 = {
                x: years,
                y: data_by_country['EU2728']
              }
              plot_data.push(trace1);

              return surveys;
            }).then(function(surveys) {
              var data = Object.values(surveys);
              var surveys = Object.keys(surveys);
              var countries = Object.keys(data[0]);
              var data_by_country = {};
              for (i = 0; i < countries.length; i++) {
                data_by_country[countries[i]] = [];
                for (j = 0; j < surveys.length; j++) {
                  data_by_country[countries[i]].push(data[j][countries[i]]);
                }
              }

              var layout = {
                xaxis: {
                  type: 'date'
                },
                yaxis: {
                  ticksuffix: '%',
                  range: [5, 35],
                  title: 'consumption share of renewable energy'
                },
                yaxis2: {
                  tickformat: ',.0%',
                  range: [0.05, 0.35],
                  overlaying: 'y',
                  side: 'right',
                  title: '\"climate change is most significant problem\"'
                },
                showlegend: false,
                hoverinfo: 'text+y',
                hovermode: 'closest'
              };

                var country_id = Object.keys(data_by_country)[0];
                var trace2 = {
                  x: surveys,
                  y: data_by_country[country_id],
                  yaxis: 'y2'
                };
                plot_data.push(trace2)

              Plotly.plot( comparison_problem_renewables_eu, plot_data, layout, {scrollZoom: true})

            });

            d3.xml("processed_data/most_serious_problem/most_serious_problem.xml")
              .then(function(data) {
                var dataobj = xmlToJson.parse(data).root.survey;
                var surveys = {};
                for (i = 0; i < dataobj.length; i++) {
                  var countries = {};
                  for (j = 0; j < dataobj[i].country.length; j++) {
                    countries[dataobj[i].country[j].id] = dataobj[i].country[j].share;
                  }
                  surveys[dataobj[i].id] = countries;
                }
                return surveys;
              }).then(function(surveys) {
                var data = Object.values(surveys);
                var surveys = Object.keys(surveys);
                var countries = Object.keys(data[0]);
                var data_by_country = {};
                for (i = 0; i < countries.length; i++) {
                  data_by_country[countries[i]] = [];
                  for (j = 0; j < surveys.length; j++) {
                    data_by_country[countries[i]].push(data[j][countries[i]]);
                  }
                }

                var layout = {
                  xaxis: {
                    type: 'category',
                    title: 'Eurobarometer Survey'
                  },
                  yaxis: {
                    tickformat: ',.0%',
                    title: 'Share of Climate Change as most significan problem'
                  },
                  legend: {
                    itemclick: 'toggleothers',
                    itemdoubleclick: 'toggle'
                  },
                  hoverinfo: 'text+y',
                  hovermode: 'closest'
                };

                var plot_data = [];
                for (i = 0; i < countries.length; i++) {
                  var country_id = Object.keys(data_by_country)[i];
                  var trace = {
                    x: surveys,
                    y: data_by_country[country_id],
                    name: country_id
                  };
                  plot_data.push(trace);
                }

                Plotly.plot( most_serious_problem_plot, plot_data, layout, {scrollZoom: true})

                alert("You clicked " + e.latlng());
              }

              L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}
            });

            d3.xml("processed_data/severity_of_problem/avg_severity.xml")
                    .then(function(data) {
                      var dataobj =  xmlToJson.parse(data).root.survey;
                      var surveys = {};
                      for (i = 0; i < dataobj.length; i++) {
                        var countries = {};
                        for (j = 0; j < dataobj[i].country.length; j++) {
                          countries[dataobj[i].country[j].id] = dataobj[i].country[j].avg;
                        }
                        surveys[dataobj[i].id] = countries;
                      }
                      return surveys;
                    }).then(function(surveys) {
              var data = Object.values(surveys);
              var surveys =  Object.keys(surveys);
              var countries = Object.keys(data[0]);
              var data_by_country = {};
              for (i = 0; i < countries.length; i++) {
                data_by_country[countries[i]] = [];
                for (j = 0; j < surveys.length; j++) {
                  data_by_country[countries[i]].push(data[j][countries[i]]);
                }
              }

              var layout = {
                xaxis: {
                  type: 'category',
                  title: 'Eurobarometer Survey'
                },
                yaxis: {
                  range: [5,10],
                  title: 'Judgment of climate change severity'
                },
                legend: {
                  itemclick: 'toggleothers',
                  itemdoubleclick: 'toggle'
                },
                hoverinfo: 'text+y',
                hovermode: 'closest'
              };

              var plot_data = [];
              for (i = 0; i < countries.length; i++) {
                var country_id = Object.keys(data_by_country)[i];
                var trace = {
                  x: surveys,
                  y: data_by_country[country_id],
                  name: country_id
                };
                plot_data.push(trace);
              }

              Plotly.plot( avg_severity_plot, plot_data, layout, {scrollZoom: true})

            });

            d3.xml("processed_data/severity_of_problem/avg_severity.xml")
                    .then(function(data) {
                      var dataobj =  xmlToJson.parse(data).root.survey;
                      var surveys = {};
                      for (i = 0; i < dataobj.length; i++) {
                        var countries = {};
                        for (j = 0; j < dataobj[i].country.length; j++) {
                          countries[dataobj[i].country[j].id] = dataobj[i].country[j].avg;
                        }
                        surveys[dataobj[i].id] = countries;
                      }
                      return surveys;
                    }).then(function(surveys) {
              var data = Object.values(surveys);
              var surveys =  Object.keys(surveys);
              var countries = Object.keys(data[0]);
              var data_by_country = {};
              for (i = 0; i < countries.length; i++) {
                data_by_country[countries[i]] = data[7][countries[i]];
              }

              var trace = {
                locations: Object.keys(data_by_country),
                z: Object.values(data_by_country),
                type: 'choropleth',
                geo: 'geo',
                colorscale: [
                  ['0', 'red'],
                  ['0.5', 'yellow'],
                  ['1', 'green']
                ],
                reversescale: false
              }

              var layout = {
                title: 'How serious do you consider the problem of climate change to be on a scale from 1 to 10?',
                geo: {
                  projection: 'mercator',
                  domain: {
                    x: [0, 1],
                    y: [0, 1]
                  },
                  lonaxis: { range: [-25, 45] },
                  lataxis: { range: [30, 80] }
                },
                hoverinfo: 'text+y',
                hovermode: 'closest'
              };

              data = [trace]
              Plotly.plot( map_severity, data, layout, {scrollZoom: true})

            });

            d3.tsv("processed_data/ghg_emissions/ghg_emissions.tsv")
                    .then(function(data) {

                      var data_by_country = {};

                      var years = [2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017];
                      var plot_data = [];

                      for (i = 0; i < data.length; i++) {
                        var country = data[i]["geo\\time"];
                        for (j = 0; j < years.length; j++) {
                          var values_by_year = Object.values(data[i]).slice(1, );
                          data_by_country[country] = values_by_year;
                        }
                        var trace = {
                          x: years,
                          y: data_by_country[country],
                          name: country
                        }
                        plot_data.push(trace);
                      }
                      var layout = {
                        xaxis: {
                          type: 'category',
                          title: 'Year'
                        },
                        yaxis: {
                          title: 'Emissions (tons per capita)'
                        },
                        legend: {
                          itemclick: 'toggleothers',
                          itemdoubleclick: 'toggle'
                        },
                        hoverinfo: 'text+y',
                        hovermode: 'closest'
                      };

                      Plotly.plot( ghg_emissions_plot, plot_data, layout, {scrollZoom: true})

                    });

            d3.tsv("processed_data/share_renewable/share_renewable.tsv")
                    .then(function(data) {
                      var data_by_country = {};

                      var years = [2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017];
                      var plot_data = [];

                      for (i = 0; i < data.length; i++) {
                        var country = data[i]["geo\\time"];
                        for (j = 0; j < years.length; j++) {
                          var values_by_year = Object.values(data[i]).slice(1, );
                          data_by_country[country] = values_by_year;
                        }
                        var trace = {
                          x: years,
                          y: data_by_country[country],
                          name: country
                        }
                        plot_data.push(trace);
                      }
                      var layout = {
                        xaxis: {
                          type: 'category',
                          title: 'Year'
                        },
                        yaxis: {
                          title: 'Share of energy from renewable sources (%)'
                        },
                        legend: {
                          itemclick: 'toggleothers',
                          itemdoubleclick: 'toggle'
                        },
                        hoverinfo: 'text+y',
                        hovermode: 'closest'
                      };

                      Plotly.plot( share_renewable_plot, plot_data, layout, {scrollZoom: true})

                    });

            d3.tsv("processed_data/share_renewable/share_renewable.tsv")
                    .then(function(data) {
                      var data_by_country = {};

                      for (i = 0; i < data.length; i++) {
                        var country = data[i]["geo\\time"];
                        var values_by_year = Object.values(data[i])[14];
                        data_by_country[country] = values_by_year;
                      }
                        var trace = {
                          locations: Object.keys(data_by_country),
                          z: Object.values(data_by_country),
                          type: 'choropleth',
                          geo: 'geo',
                          colorscale: [
                                  ['0', 'red'],
                                  ['0.5', 'yellow'],
                                  ['1', 'green']
                          ],
                          reversescale: false
                        }
                      var layout = {
                        title: 'Share of energy consumption from renewable sources in 2017 (in %)',
                        geo: {
                          projection: 'mercator',
                          domain: {
                            x: [0, 1],
                            y: [0, 1]
                          },
                          lonaxis: { range: [-25, 45] },
                          lataxis: { range: [30, 80] }
                        },
                        hoverinfo: 'text+y',
                        hovermode: 'closest'
                      };

                    data = [trace]
                    Plotly.plot( map_renewables_2017, data, layout, {scrollZoom: true})

                    });

          </script>
        </div> -->

